/**
*
*   ModelView.js
*   @version: 0.81.1
*   @built on 2016-05-22 18:23:10
*
*   A simple/extendable MV* (MVVM) framework
*   optionaly integrates into both jQuery as MVVM plugin and jQueryUI as MVC widget
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n){"use strict";var i;"object"==typeof module&&module.exports?module.exports=n.call(e,{}):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(t,[],function(i){i(t,n.call(e,{}))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e,{})}):t in e||(e[t]=i=n.call(e,{}))&&"function"==typeof define&&define.amd&&define(function(){return i})}(this,"ModelView",function(e){"use strict";function t(e,t){var n=[e||"",Qe];return t&&(n=n.concat(t)),n.join(".")}function n(e){return-1<Je.indexOf(e)}function i(e,t){return e===t}function r(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function l(e,t){return e===t.id}function o(e,t){return t[De](e)}function a(e){var t=this;return t instanceof a?(e&&t.element(e),void(t.$handle=a.Handler.bind(t))):new a(e)}var u=void 0,s=function(e,t){return e.bind(t)},c="prototype",f=Array,d=f[c],h=RegExp,p=(Number,Object),v=p[c],g=p.create,$=p.keys,m=Function,b=(m[c],String),y=b[c],_=v.toString,k=d.slice,w=function(e){return b(e)},E=function(e,t){return new m(e,t)},x=function(e,t){return e instanceof t},S=1/0,C=(Math.random,/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g),L=function(e){return e.replace(C,"\\$&")},O=function(e,t,n){return e[t]=u,n||delete e[t],e},j=4,M=8,N=16,D=32,A=33,V=34,P=64,R=128,I=129,H=256,z=512,F=1024,B=2048,U=4096,X=8192,q=8192,W=R|H,K=z|H,Q={"[object Number]":D,"[object String]":R,"[object Array]":H,"[object RegExp]":B,"[object Date]":U,"[object Function]":F,"[object File]":q,"[object Blob]":X,"[object Object]":z},Y=function(e){var t=0;return null===e?t=N:!0===e||!1===e||e instanceof Boolean?t=P:u===e?t=M:(t=Q[_.call(e)]||j,t=D===t||e instanceof Number?isNaN(e)?V:isFinite(e)?D:A:R===t||e instanceof String?1===e.length?I:R:H===t||e instanceof Array?H:B===t||e instanceof RegExp?B:U===t||e instanceof Date?U:q===t||e instanceof File?q:X===t||e instanceof Blob?X:F===t||e instanceof Function?F:z===t?z:j),t},Z=function(e,t){return!!(t&Y(e))},G=function(e){return!isNaN(parseFloat(e,10))&&isFinite(e)},J=function(e){return!!(G(e)&&(e=+e,0===e%1&&e>=0))},ee=function(e,t){var n,i=e.length,r=15&i,l=1&r,o=new Array(i);for(l&&(o[0]=t(e[0])),n=l;r>n;n+=2)o[n]=t(e[n]),o[n+1]=t(e[n+1]);for(n=r;i>n;n+=16)o[n]=t(e[n]),o[n+1]=t(e[n+1]),o[n+2]=t(e[n+2]),o[n+3]=t(e[n+3]),o[n+4]=t(e[n+4]),o[n+5]=t(e[n+5]),o[n+6]=t(e[n+6]),o[n+7]=t(e[n+7]),o[n+8]=t(e[n+8]),o[n+9]=t(e[n+9]),o[n+10]=t(e[n+10]),o[n+11]=t(e[n+11]),o[n+12]=t(e[n+12]),o[n+13]=t(e[n+13]),o[n+14]=t(e[n+14]),o[n+15]=t(e[n+15]);return o},te=function(e,t){var n,i=e.length,r=15&i,l=1&r,o=[];for(l&&t(e[0])&&o.push(e[0]),n=l;r>n;n+=2)t(e[n])&&o.push(e[n]),t(e[n+1])&&o.push(e[n+1]);for(n=r;i>n;n+=16)t(e[n])&&o.push(e[n]),t(e[n+1])&&o.push(e[n+1]),t(e[n+2])&&o.push(e[n+2]),t(e[n+3])&&o.push(e[n+3]),t(e[n+4])&&o.push(e[n+4]),t(e[n+5])&&o.push(e[n+5]),t(e[n+6])&&o.push(e[n+6]),t(e[n+7])&&o.push(e[n+7]),t(e[n+8])&&o.push(e[n+8]),t(e[n+9])&&o.push(e[n+9]),t(e[n+10])&&o.push(e[n+10]),t(e[n+11])&&o.push(e[n+11]),t(e[n+12])&&o.push(e[n+12]),t(e[n+13])&&o.push(e[n+13]),t(e[n+14])&&o.push(e[n+14]),t(e[n+15])&&o.push(e[n+15]);return o},ne=function(e,t){var n,i=e.length,r=15&i,l=1&r;for(l&&t(e[0]),n=l;r>n;n+=2)t(e[n]),t(e[n+1]);for(n=r;i>n;n+=16)t(e[n]),t(e[n+1]),t(e[n+2]),t(e[n+3]),t(e[n+4]),t(e[n+5]),t(e[n+6]),t(e[n+7]),t(e[n+8]),t(e[n+9]),t(e[n+10]),t(e[n+11]),t(e[n+12]),t(e[n+13]),t(e[n+14]),t(e[n+15]);return e},ie=function(e,t,n,i){if(t>n)return i;if(t===n)return e(t,i,t,n),i;var r,l,o=n-t+1,a=15&o,u=1&a;for(u&&e(t,i,t,n),r=u;a>r;r+=2)l=t+r,e(l,i,t,n),e(++l,i,t,n);for(r=a;o>r;r+=16)l=t+r,e(l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n),e(++l,i,t,n);return i},re=function(){var e,t,n,i,r,l,o,a=arguments;for(t=a[0]||{},e=a.length,l=1;e>l;l++)if(n=a[l],z===Y(n))for(r in n)i=n[r],o=Y(i),D&o?t[r]=0+i:W&o?t[r]=i.slice(0):t[r]=i;return t},le="hasOwnProperty",oe="getAttribute",ae="setAttribute",ue="hasAttribute",se="checked",ce="disabled",fe="selected",de="name",he="tagName",pe="type",ve="value",ge="options",$e="selectedIndex",me="parentNode",be="style",ye="innerHTML",_e="innerText",ke="textContent",we=JSON.parse,Ee=(JSON.stringify,y.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s+|\s+$/g,"")}),Te=y.startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return t===e.slice(n||0,t.length)},xe=Date.now?Date.now:function(){return(new Date).getTime()},Se=function(){var e,t,n,i,r,l,o,a,u,s,c,f,d,h,p,v=arguments,g=v.length,$="|^",m="|v";if(g){for(o=1,p=[],l=[],f=[],c=[],e=g-1;e>=0;e--)s=v[e],c.unshift("f"+e),s.push?(f.unshift(s[1]),s=s[0]):f.unshift(null),h=s.slice(-2),m===h?(d=!0,s=s.slice(0,-2)):$===h?(d=!1,s=s.slice(0,-2)):d=!1,s=s.length?'["'+s.split(".").join('"]["')+'"]':"",t="a"+s,n="b"+s,f[0]&&(t=c[0]+"("+t+")",n=c[0]+"("+n+")"),i="a_"+e,r="b_"+e,l.unshift(""+i+"="+t+","+r+"="+n),a=d?""+o:"-"+o,u=d?"-"+o:""+o,p.unshift("("+i+" < "+r+" ? "+a+" : ("+i+" > "+r+" ? "+u+" : 0))"),o<<=1;return E(c.join(","),["return function(a,b) {","  var "+l.join(",")+";","  return "+p.join("+")+";","};"].join("\n")).apply(null,f)}return t="a",n="b",a="-1",u="1",p=""+t+" < "+n+" ? "+a+" : ("+t+" > "+n+" ? "+u+" : 0)",E("a,b","return "+p+";")},Ce=function(e){for(var t=0;e=e.previousSibling;)t++;return t},Le=function(e,t){var n=e;if(t)for(;n[me]&&n[me]!==t;)n=n[me];return Ce(n)},Oe=function(e,t,n){var i,r=e.childNodes,l=r.length,o=null,a=0,u=0;for(n=n||1;l>a&&(i=r[a++],t!==i.nodeType||(o=i,++u!==n)););return o},je=function(e,t){return k.call((t||document).getElementsByTagName(e),0)},Me=function(e,t,n){return!0===n?[(t||document).querySelector(e)]:k.call((t||document).querySelectorAll(e),0)},Ne=function(e,t){return Te(t,"$this::")?Me(t.slice(7),e):Me(t,null)},De=(function(){var e=document.createElement("div");return"outerHTML"in e?function(e){return e.outerHTML}:function(t){var n=e.cloneNode();return n.appendChild(t.cloneNode(!0)),n.innerHTML}}(),function(e){return!e||e.matches?"matches":e.matchesSelector?"matchesSelector":e.webkitMatchesSelector?"webkitMatchesSelector":e.mozMatchesSelector?"mozMatchesSelector":e.msMatchesSelector?"msMatchesSelector":e.oMatchesSelector?"oMatchesSelector":void 0}(this.Element?this.Element[c]:null)),Ae="undefined"!=typeof window&&window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},Ve=function(e){e._displayCached||(e._displayCached=Ae(e).display||"block"),e[be].display="none"!==e._displayCached?e._displayCached:"block",e._displayCached=u},Pe=function(e){e._displayCached||(e._displayCached=Ae(e).display||"block"),e[be].display="none"},Re=function(e){var t=e.attributes[ve];return!t||t.specified?e[ve]:e.text},Ie=function(e){for(var t,n,i=e[ge],r=e[$e],l="select-one"===e[pe]||0>r,o=l?null:[],a=l?r+1:i.length,u=0>r?a:l?r:0;a>u;u++)if(n=i[u],(n[fe]||u===r)&&!n[ce]&&(!n[me][ce]||"OPTGROUP"!==n[me][he])){if(t=Re(n),l)return t;o.push(t)}return o},He=function(e,t){var n,i,r=ee([].concat(t),w),l=e[ge];for(i=0;i<l.length;i++)n=l[i],n[fe]=-1<r.indexOf(Re(n));r.length||(e[$e]=-1)},ze=function(e){if(e){var t=null;switch(e[ue]("data-alt-value")&&(t=e[oe]("data-alt-value")),e[he]){case"INPUT":return"file"===e.type.toLowerCase()?t&&null!=e[t]&&e[t].length?e[t]:e.files.length?e.files:null:t&&null!=e[t]?e[t]:e[ve];case"TEXTAREA":return t&&null!=e[t]?e[t]:e[ve];case"SELECT":return t&&null!=e[t]?e[t]:Ie(e);default:return t&&null!=e[t]?e[t]:ke in e?e[ke]:e[_e]}}},Fe=function(e,t){if(e){var n=null;switch(e[ue]("data-alt-value")&&(n=e[oe]("data-alt-value")),e[he]){case"INPUT":"file"===e.type.toLowerCase()||(e[ve]=b(t),n&&(e[n]=null));break;case"TEXTAREA":e[ve]=b(t),n&&(e[n]=null);break;case"SELECT":He(e,t),n&&(e[n]=null);break;default:ke in e?e[ke]=b(t):e[_e]=b(t),n&&(e[n]=null)}}},Be=function(e){return e.length>0},Ue=/\s+/g,Xe=function(e){var t=e.split("."),n=t[0];return t=te(t.slice(1),Be),[n,t.sort()]},qe=function(e){return e.length?new h("(^|\\.)"+e.join("\\.(?:.*\\.|)")+"(\\.|$)"):!1},We=function(e,t){var n=this;n.v=e||null,n.n=t||{}},Ke="*",Qe="modelview",Ye=0,Ze=function(e){return[e||"UUID",++Ye,xe()].join("_")};HTMLElement.prototype.addEventListener||!function(){function e(e,t){Window.prototype[e]=HTMLDocument.prototype[e]=HTMLElement.prototype[e]=Element.prototype[e]=t}e("addEventListener",function(e,t){var n=this,i=n.addEventListener.listeners=n.addEventListener.listeners||{},r=i[e]=i[e]||[];r.length||(r.event=function(e){var t=n.document&&n.document.documentElement||n.documentElement||{scrollLeft:0,scrollTop:0};e.currentTarget=n,e.pageX=e.clientX+t.scrollLeft,e.pageY=e.clientY+t.scrollTop,e.preventDefault=function(){e.returnValue=!1},e.relatedTarget=e.fromElement||null,e.stopImmediatePropagation=function(){a=!1,e.cancelBubble=!0},e.stopPropagation=function(){e.cancelBubble=!0},e.target=e.srcElement||n,e.timeStamp=+new Date;for(var i,l=0,o=[].concat(r),a=!0;a&&(i=o[l]);++l)for(var u,s=0;u=r[s];++s)if(u==i){u.call(n,e);break}},n.attachEvent?n.attachEvent("on"+e,r.event):n["on"+e]=r.event),r.push(t)}),e("removeEventListener",function(e,t){for(var n,i=this,r=i.addEventListener.listeners=i.addEventListener.listeners||{},l=r[e]=r[e]||[],o=l.length-1;n=l[o];--o)if(n==t){l.splice(o,1);break}!l.length&&l.event&&(i.detachEvent?i.detachEvent("on"+e,l.event):i["on"+e]=!1)}),e("dispatchEvent",function(e){var t=this,n=e.type,i=t.addEventListener.listeners=t.addEventListener.listeners||{},r=i[n]=i[n]||[];try{return t.fireEvent("on"+n,e)}catch(l){return void(r.event&&r.event(e))}})}();var Ge="DOMEVENT_STOPPED",Je=["blur","error","focus","focusin","focusout","load","resize","scroll"];a.Handler=function(e){if(!e[Ge]){var t,n,i,r,l,o,a,u=this,s=e.type,c=e.target,f=[];switch(c&&3===c.nodeType&&(c=c.parentNode),r=u.$element,i=r.$listeners,l=e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:f=i[1][s];break;case 2:i[0]&&i[0][s]&&(f=f.concat(i[0][s])),i[1]&&i[1][s]&&(f=f.concat(i[1][s]));break;case 3:f=i[0][s]}if(f)for(n=f.length;n&&c;){for(t=0;n>t;t++){if(!f)return;if(o=f[t],!o)break;if(o.matcher(o.matcherParam,c)&&(a=o.handler.call(c,e,c)),!1===a||!1===e.returnValue)return e[Ge]=!0,void e.preventDefault()}if(r===c)break;n=f.length,c=c.parentElement}}},a.Dispatch=function(e,t,n){var i;document.createEvent?(i=document.createEvent("HTMLEvents"),i.initEvent(e,!0,!0),i.eventName=e,null!=n&&(i.data=n),t.dispatchEvent(i)):(i=document.createEventObject(),i.eventType=e,i.eventName=e,null!=n&&(i.data=n),t.fireEvent("on"+i.eventType,i))},a[c]={constructor:a,$element:null,$handle:null,dispose:function(){var e=this;return e.off().element(),e.$element=null,e.$handle=null,e},element:function(e){var t,n,i,r=this,l=r.$element;if(l){for(t=l.$listeners,n=$(t[1]),i=0;i<n.length;i++)l.removeEventListener(n[i],r.$handle,!0);for(n=$(t[0]),i=0;i<n.length;i++)l.removeEventListener(n[i],r.$handle,!1);l.$listeners=u}return e&&e.addEventListener?(r.$element=e,e.$listeners=e.$listeners||[{},{}],r):(r.$element=null,r)},on:function(e,t,a,s){var c,f,d,h,p,v,g,$,m=this;if(c=m.$element,!c)return m;if(!e)throw new TypeError("Invalid event type: "+e);if(g=e.split(Ue).map(Xe),!g.length)return m;if("function"==typeof t&&(s=a,a=t,t=null),"function"!=typeof a)throw new TypeError("Handler must be a type of Function");for(h=0,p=g.length;p>h;h++)$=u===s?n(g[h][0]):!!s,f=c.$listeners[$?1:0],f[g[h][0]]||(f[g[h][0]]=[],c.addEventListener(g[h][0],m.$handle,$)),t?/^[a-z]+$/i.test(t)?(v=t,d=r):/^#[a-z0-9\-_]+$/i.test(t)?(v=t.slice(1),d=l):(v=t,d=o):(v=c,d=i),f[g[h][0]].push({selector:t,handler:a,matcher:d,matcherParam:v,namespace:g[h][1].join(".")});return m},off:function(e,t,n,i){var r,l,o,a,s,c,f,d,h,p,v=this,g=v.$element,$=!1;if(!g)return v;if("function"==typeof t&&(i=n,n=t,t=null),$=u===i?[0,1]:i?[1]:[0],p=e?e.split(/\s+/g).map(Xe):[],p.length){for(c=0;c<$.length;c++)for(o=g.$listeners[$[c]],s=0;s<p.length;s++)if(d=p[s][1],f=p[s][0],h=qe(d),f.length){if(a=o[f],!a||!a.length)continue;for(r=a.length-1;r>=0;r--)l=a[r],t&&t!==l.selector||n&&n!==l.handler||h&&!h.test(l.namespace)||a.splice(r,1);a.length||(delete o[f],g.removeEventListener(f,v.$handle,!!$[c]))}else for(f in o)if(a=o[f],a&&a.length){for(r=a.length-1;r>=0;r--)l=a[r],t&&t!==l.selector||n&&n!==l.handler||h&&!h.test(l.namespace)||a.splice(r,1);a.length||(delete o[f],g.removeEventListener(f,v.$handle,!!$[c]))}}else for(c=0;c<$.length;c++){o=g.$listeners[$[c]];for(f in o)if(a=o[f],a&&a.length){for(r=a.length-1;r>=0;r--)l=a[r],t&&t!==l.selector||n&&n!==l.handler||a.splice(r,1);a.length||(delete o[f],g.removeEventListener(f,v.$handle,!!$[c]))}}return v}};var et=2,tt=function(e,t,n){var i=this;return i instanceof tt?(i.type=e,i.target=t,i.currentTarget=t,i.timeStamp=xe(),i.eventPhase=et,void(i.namespace=n||null)):new tt(e,t,n)};tt[c]={constructor:tt,type:null,target:null,currentTarget:null,timeStamp:null,eventPhase:et,bubbles:!1,cancelable:!1,namespace:null,stopPropagation:function(){this.bubbles=!1},preventDefault:function(){}};var nt={$PB:null,namespace:null,initPubSub:function(){var e=this;return e.$PB={},e},disposePubSub:function(){var e=this;return e.$PB=null,e},trigger:function(e,t){var n,i,r,l,o,a,u,s=this,c=s.$PB;if(a=Xe(e),e=a[0],u="evt_"+e,c[le](u)&&(n=c[u])&&(o=n.length)){for(i=n.slice(0),a=a[1].join("."),e=new tt(e,s,a),l=0;o>l&&(r=i[l],r[2]&&r[3]||(r[3]=1,!1!==r[0](e,t)));l++);if(c[le](u)&&(n=c[u])&&(o=n.length))if(n.oneOffs>0)for(l=o-1;l>=0;l--)i=n[l],i[2]&&i[3]&&(n.splice(l,1),n.oneOffs=n.oneOffs>0?n.oneOffs-1:0);else n.oneOffs=0}return s},on:function(e,t,n){var i,r,l,o,a,u=this,s=u.$PB;if(e&&e.length&&Z(t,F)){if(n=!!n,r=e.split(Ue).map(Xe),!(a=r.length))return u;for(o=0;a>o;o++)e=r[o][0],i=r[o][1].join("."),l="evt_"+e,s[le](l)||(s[l]=[],s[l].oneOffs=0),s[l].push([t,i,n,0]),n&&s[l].oneOffs++}return u},onTo:function(e,t,n,i){var r=this;return Z(n,F)&&(n=s(n,r)),e.on(t,n,i),r},off:function(e,t){var n,i,r,l,o,a,u,s,c,f,d,h=this,p=h.$PB;if(e&&e.length){for(u=Z(t,F),s=e.split(Ue).map(Xe),c=0,f=s.length;f>c;c++)if(e=s[c][0],a=qe(s[c][1]),e.length){if(d="evt_"+e,p[le](d)&&(n=p[d])&&(l=n.length))for(r=l-1;r>=0;r--)o=n[r],u&&t!==o[0]||a&&!a.test(o[1])||(o[2]&&(n.oneOffs=n.oneOffs>0?n.oneOffs-1:0),n.splice(r,1))}else if(u||a)for(i in p)if(p[le](i)){if(n=p[i],!n||!(l=n.length))continue;for(r=l-1;r>=0;r--)o=n[r],u&&t!==o[0]||a&&!a.test(o[1])||(o[2]&&(n.oneOffs=n.oneOffs>0?n.oneOffs-1:0),n.splice(r,1))}}else for(i in p)p[le](i)&&delete p[i];return h},offFrom:function(e,t,n){var i=this;return e.off(t,n),i}};nt.publish=nt.trigger;var it=function(e,t){var n=this,i=arguments.length;n.$store={},n.$size=S,n.$interval=S,i>0&&e>0&&(n.$size=e),i>1&&t>0&&(n.$interval=t)};it[c]={constructor:it,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store["_"+e]:null;return!!(n&&xe()-n.time<=t.$interval)},get:function(e){if(e){var t,n=this,i=n.$store,r="_"+e;if(i[le](r))return t=i[r],xe()-t.time>n.$interval?(delete i[r],u):t.data}return u},set:function(e,t){var n,i,r,l,o=this;if(e){for(l="_"+e,n=o.$store,i=o.$size,r=$(n);r.length>=i;)delete n[r.shift()];n[l]={key:e,data:t,time:xe()}}return o},del:function(e){var t=e?"_"+e:null;return t&&this.$store[le](t)&&delete this.$store[t],this},toString:function(){return"[ModelView.Cache]"}};var rt=function an(e){return x(this,an)?void(this.f=e||null):new an(e)},lt=function un(e){return x(this,un)?(this.f=e||null,void(this.fEach=1)):new un(e)},ot=(Math.floor,Math.round,Math.abs,/\$0/g),at=function sn(e){return e.NOT=function(){return sn(function(t,n){return!e.call(this,t,n)})},e.AND=function(t){return sn(function(n,i){var r=this;return e.call(r,n,i)&&t.call(r,n,i)})},e.OR=function(t){return sn(function(n,i){var r=this;return e.call(r,n,i)||t.call(r,n,i)})},e.XOR=function(t){return sn(function(n,i){var r=this,l=e.call(r,n,i),o=t.call(r,n,i);return l&&!o||o&&!l})},e.EQ=function(t,n){return sn(!1!==n?function(n,i){var r=this,l=e.call(r,n,i),o=t.call(r,n,i);return l===o}:function(n,i){var r=this,l=e.call(r,n,i),o=t.call(r,n,i);return l==o})},e.NEQ=function(t,n){return sn(!1!==n?function(n,i){var r=this,l=e.call(r,n,i),o=t.call(r,n,i);return l!==o}:function(n,i){var r=this,l=e.call(r,n,i),o=t.call(r,n,i);return l!=o})},e},ut={tpl_$0:ot,TypeCaster:function(e){return e},Cast:{COMPOSITE:function(){var e=arguments;return Z(e[0],H)&&(e=e[0]),function(t,n){for(var i=e.length;i--;)t=e[i].call(this,t,n);return t}},EACH:lt,FIELDS:function(e){return e=re({},e||{}),function(t){var n,i,r,l=this;for(n in e)e[le](n)&&(i=e[n],r=t[n],i.fEach&&Z(r,H)?t[n]=ie(function(e,t){t[e]=i.f.call(l,t[e])},0,r.length-1,r):t[n]=i.call(l,r));return t}},DEFAULT:function(e){return function(t){var n=Y(t);return(M&n||R&n&&!Ee(t).length)&&(t=e),t}},BOOL:function(e){if(Z(e,R)&&e.length){var t=e.toLowerCase();return"true"===t||"on"===t||"1"===t}return!!e},INT:function(e){return parseInt(e,10)||0},FLOAT:function(e){return parseFloat(e,10)||0},MIN:function(e){return function(t){return e>t?e:t}},MAX:function(e){return function(t){return t>e?e:t}},CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return function(n){return e>n?e:n>t?t:n}},TRIM:function(e){return Ee(b(e))},STR:function(e){return""+e}},add:function(e,t){return Z(e,R)&&Z(t,F)&&(ut.Cast[e]=t),ut},del:function(e){return Z(e,R)&&ut.Cast[le](e)&&delete ut.Cast[e],ut},toString:function(){return"[ModelView.Type]"}},st={Validator:at,Validate:{EACH:lt,FIELDS:function(e){return e=re({},e||{}),at(function(t){var n,i,r,l,o,a=this;for(n in e)if(e[le](n))if(i=e[n],r=t[n],i.fEach&&Z(r,H)){for(l=r.length,o=0;l>o;o++)if(!i.f.call(a,r[o]))return!1}else if(!i.call(a,r))return!1;return!0})},NUMERIC:at(function(e){return G(e)}),EMPTY:at(function(e){return!e||!Ee(b(e)).length}),NOT_EMPTY:at(function(e){return!!(e&&0<Ee(b(e)).length)}),MAXLEN:function(e){return at(E("v","return v.length <= "+(e||0)+";"))},MINLEN:function(e){return at(E("v","return v.length >= "+(e||0)+";"))},MATCH:function(e){return at(function(t){return e.test(t)})},NOT_MATCH:function(e){return at(function(t){return!e.test(t)})},EQUAL:function(e,t){return at(x(e,rt)?E("v","return this.$data."+e.f+" "+(!1!==t?"===":"==")+" v;"):!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return at(x(e,rt)?E("v","return this.$data."+e.f+" "+(!1!==t?"!==":"!=")+" v;"):!1!==t?function(t){return e!==t}:function(t){return e!=t})},GREATER_THAN:function(e,t){return x(e,rt)?e="this.$data."+e.f:Z(e,R)&&(e='"'+e+'"'),at(E("v","return "+e+" "+(!1!==t?"<":"<=")+" v;"))},LESS_THAN:function(e,t){return x(e,rt)?e="this.$data."+e.f:Z(e,R)&&(e='"'+e+'"'),at(E("v","return "+e+" "+(!1!==t?">":">=")+" v;"))},BETWEEN:function(e,t,n){Z(e,H)&&(n=t,t=e[1],e=e[0]);var i,r=x(e,rt),l=x(t,rt);return!r&&!l&&e>t&&(i=t,t=e,e=i),e=r?"this.$data."+e.f:Z(e,R)?'"'+e+'"':e,t=l?"this.$data."+t.f:Z(t,R)?'"'+t+'"':t,at(!1!==n?E("v","return ( "+e+" < v ) && ( "+t+" > v );"):E("v","return ( "+e+" <= v ) && ( "+t+" >= v );"))},NOT_BETWEEN:function(e,t,n){Z(e,H)&&(n=t,t=e[1],e=e[0]);var i,r=x(e,rt),l=x(t,rt);return!r&&!l&&e>t&&(i=t,t=e,e=i),e=r?"this.$data."+e.f:Z(e,R)?'"'+e+'"':e,t=l?"this.$data."+t.f:Z(t,R)?'"'+t+'"':t,at(!1!==n?E("v","return ( "+e+" > v ) || ( "+t+" < v );"):E("v","return ( "+e+" >= v ) || ( "+t+" <= v );"))},IN:function(){var e=k.call(arguments);return Z(e[0],H)&&(e=e[0]),at(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=k.call(arguments);return Z(e[0],H)&&(e=e[0]),at(function(t){return 0>e.indexOf(t)})}},add:function(e,t){return Z(e,R)&&Z(t,F)&&(st.Validate[e]=Z(t.XOR,F)?t:at(t)),st},del:function(e){return Z(e,R)&&st.Validate[le](e)&&delete st.Validate[e],st},toString:function(){return"[ModelView.Validation]"}},ct=function(e,t){if(!e)return null;var n=ie(function(n,i){var r=e[n];r&&(r[le](t)&&i.push(r[t].n),r[le](Ke)&&i.push(r[Ke].n))},0,e.length-1,[]);return n.length?n:null},ft=function(e,t){if(!e)return null;var n,i,r=e.length;if(u!==t){for(n=0;r>n;n++)if(i=e[n]){if(i[le](t)&&i[t].v)return i[t].v;if(i[le](Ke)&&i[Ke].v)return i[Ke].v}}else for(n=0;r>n;n++)if(i=e[n],i&&i.v)return i.v;return null},dt=function(e,t,n,i){for(var r,l=n,o=0,a=t.length;a>o;)r=t[o++],l[le](r)||(l[r]=new We),l=l[r],a>o?l=l.n:i?(l.n[le](Ke)||(l.n[Ke]=new We),l.n[Ke].v=e):l.v=e;return n},ht=function(e,t,n,i){for(var r,l,o=t,a=n?[n]:null,u=0,s=e.length;s>u;){if(r=e[u++],l=Y(o),!(s>u))return a&&ft(a,r)?!0:l&K&&o[le](r)?!0:z===l&&"length"==r;if(l&K&&o[le](r)){if(o=o[r],o instanceof i)return[i,o,e.slice(u)];a&&(a=ct(a,r))}else if(!a||!(a=ct(a,r)))return!1}return!1},pt=function(e,t,n,i){for(var r,l,o=t,a=n?[n]:null,u=0,s=e.length;s>u;){if(r=e[u++],l=Y(o),!(s>u))return a&&(a=ft(a,r))?[!1,a]:l&K&&o[le](r)?[!0,o[r]]:z===l&&"length"==r?[!0,$(o).length]:!1;if(l&K&&o[le](r)){if(o=o[r],o instanceof i)return[i,o,e.slice(u)];a&&(a=ct(a,r))}else if(!a||!(a=ct(a,r)))return!1}return!1},vt=function(e,t,n,i){for(var r,l,o=t,a=n,u=0,s=e.length;s>u;){if(r=e[u++],l=Y(o),!(s>u))return o[r]instanceof i?[i,o[r],e.slice(u)]:a&&l&K&&o[le](r)?[!0,o,r,a]:!1;if(!(l&K&&o[le](r)))return!1;if(o=o[r],o instanceof i)return[i,o,e.slice(u)];if(!a||!(a=ct(a,r)))return!1}return!1},gt=function(e,t,n,i,r,l,o){var a,u,s=t,c=null,f=null,d=null,h=0,p=e.length;for(o=!1!==o,o&&(c=[n],f=[i],d=[r]);p>h;)if(a=e[h++],u=Y(s),p>h)if(u&K&&s[le](a)){if(s=s[a],s instanceof l)return[l,s,e.slice(h),0,null,null,null];o&&(c=ct(c,a),f=ct(f,a),d=ct(d,a))}else{if(!(o&&d&&(d=ct(d,a))))return[!1,s,a,e,null,null,null];c=ct(c,a),f=ct(f,a)}else if(u&K)return s[a]instanceof l?[l,s[a],e.slice(h),0,null,null,null]:s[le](a)?[!0,s,a,e.slice(h),c,f,d]:[!1,s,a,e.slice(h),c,f,d];return[!1,s,a,e.slice(h),null,null,null]},$t=/\[([^\]]*)\]/g,mt=/^\.+|\.+$/g,bt=function(e){return e.replace($t,".$1").replace(mt,"")},yt=function(e){return"["+e.split(".").join("][")+"]"},_t=function(e){var t=new h("^"+e+"([\\.|\\[])");return function(e,n){var i=e.replace(t,"$1");return n?bt(i):i}},kt=function cn(e,t,n,i){var r,l,o=!1;if(o=x(n,lt))n=n.f,dt(n,-1<t.indexOf(".")?t.split("."):[t],i,o);else if(l=Y(n),F&l)dt(n,-1<t.indexOf(".")?t.split("."):[t],i,o);else if(K&l)for(r in n)n[le](r)&&cn(e,t+"."+r,n[r],i)},wt=function fn(e,t,n,i){var r,l;if(l=Y(n),F&l)dt(n,-1<t.indexOf(".")?t.split("."):[t],i);else if(K&l)for(r in n)n[le](r)&&fn(e,t+"."+r,n[r],i)},Et=function dn(e,t,n){var i,r;for(i in n)n[le](i)&&(r=n[i],t[le](i)?Z(t[i],K)&&Z(r,K)&&(t[i]=dn(e,t[i],r)):t[i]=r);return t},Tt=function hn(e,t,n,i){var r,l;for(arguments.length<3&&(n=e.$data);n instanceof t;)n=n.data();if(l=i||Y(n),n=z&l?re({},n):H&l?n.slice(0):n,K&l)for(r in n)n[le](r)&&(n[r]instanceof t?n[r]=hn(n[r],t,re({},n[r].data())):K&(l=Y(n[r]))&&(n[r]=hn(e,t,n[r],l)));return n},xt=function pn(e,t,n,i,r,l){var o,a,u,s,c,f,d;if(l=l?l+".":"",i=i||e.$data,r=r||[e.$types],r&&r.length)if(n){if(c=vt(d=n.split("."),o=i,r,t))if(o=c[1],a=c[2],t===c[0])f=d.slice(0,d.length-a.length).join("."),pn(o,t,a.length?a.join("."):null);else if(f=d.slice(0,-1).join("."),u=o[a],s=ft(c[3],a),s&&(o[a]=s.call(e,u,l+n)),K&Y(u)&&(r=ct(c[3],a))&&r.length){f+=f?"."+a:a,f=l+f;for(a in u)u[le](a)&&pn(e,t,a,u,r,f)}}else if(K&Y(i))for(a in i)i[le](a)&&pn(e,t,a,i,r)},St=function vn(e,t,n,i,r,l){var o,a,u,s,c,f,d,h,p,v={isValid:!0,errors:[]};if(r=r||e.$data,l=l||[e.$validators],l&&l.length)if(i){if(p=function(e){return d?d+"."+e:e},c=vt(h=i.split("."),o=r,l,t))if(o=c[1],a=c[2],t===c[0]){if(d=h.slice(0,h.length-a.length).join("."),f=vn(o,t,n,a.length?a.join("."):null),f.isValid||(v.errors=v.errors.concat(ee(f.errors,p)),v.isValid=!1),!v.isValid&&n)return v}else{if(d=h.slice(0,-1).join("."),u=o[a],s=ft(c[3],a),s&&!s.call(e,u,i)&&(v.errors.push(i),v.isValid=!1,n))return v;if(K&Y(u)&&(l=ct(c[3],a))&&l.length){d+=d?"."+a:a;for(a in u)if(u[le](a)&&(f=vn(e,t,n,a,u,l),f.isValid||(v.errors=v.errors.concat(ee(f.errors,p)),v.isValid=!1),n&&!v.isValid))return v}}}else if(K&Y(r))for(a in r)if(r[le](a)&&(f=vn(e,t,n,a,r,l),f.isValid||(v.errors=v.errors.concat(f.errors),v.isValid=!1),n&&!v.isValid))return v;return v},Ct=function(e,t){var n,i,r,l,o,a,u,s,c,f,d,h,p,v,g,m=e.target,b=m.$syncTo,y=t.key;if(y){for(i=y+".",r=$(b),l=r.length,p=m.atomic,v=m.$atom,m.atomic=!0,m.$atom=y,s=0;l>s;s++)if(c=r[s],c===y||Te(c,i))for(f=b[c],n=m.get(c),d=0,h=f.length;h>d;d++)a=f[d][0],o=f[d][1],m.__syncing[a.$id]=m.__syncing[a.$id]||[],g=m.__syncing[a.$id],0>g.indexOf(o)&&(g.push(o),(u=f[d][2])?u.call(a,o,n,c,m):a.set(o,n,1),g.pop());m.$atom=v,m.atomic=p}},Lt=function gn(e,t,n,i,r,l,o){var a=this;return a instanceof gn?(a.$id=Ze("Model"),a.namespace=a.id=e||a.$id,a.key=_t(a.id),a.$view=null,a.atomic=!1,a.$atom=null,a.$autovalidate=!0,a.$types={},a.$validators={},a.$getters={},a.$setters={},a.$idependencies={},a.$syncTo={},void a.data(t||{}).types(n).validators(i).getters(r).setters(l).dependencies(o).initPubSub()):new gn(e,t,n,i,r,l,o)};Lt.count=function(e){if(!arguments.length)return 0;var t=Y(e);return z===t?$(e).length:H===t?e.length:M!==t?1:0},Lt.Sorter=Se,Lt.Field=rt,Lt[c]=re(g(p[c]),nt,{constructor:Lt,id:null,$id:null,$view:null,$data:null,$types:null,$idependencies:null,$validators:null,$getters:null,$setters:null,atomic:!1,$atom:null,$autovalidate:!0,$syncTo:null,$syncHandler:null,__syncing:null,dispose:function(){var e=this;return e.disposePubSub().$view=null,e.$data=null,e.$types=null,e.$idependencies=null,e.$validators=null,e.$getters=null,e.$setters=null,e.atomic=!1,e.$atom=null,e.key=null,e.$autovalidate=!1,e.$syncTo=null,e.$syncHandler=null,e.__syncing=null,e},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},dependencies:function(e){var t,n,i,r,l,o,a=this,u=a.$idependencies;if(Z(e,z))for(t in e)if(e[le](t))for(n=e[t]?[].concat(e[t]):[],i=0;i<n.length;i++)for(l=n[i].split("."),r=l[0],u[le](r)||(u[r]=[]),0>u[r].indexOf(t)&&u[r].push(t),o=1;o<l.length;o++)r+="."+l[o],u[le](r)||(u[r]=[]),0>u[r].indexOf(t)&&u[r].push(t);return a},defaults:function(e){var t,n,i=this,r=i.$data;if(Z(e,z))for(t in e)e[le](t)&&(n=e[t],r[le](t)?Z(r[t],K)&&Z(n,K)&&(r[t]=Et(i,r[t],n)):r[t]=n);return i},types:function(e){var t,n=this;if(Z(e,z))for(t in e)e[le](t)&&kt(n,t,e[t],n.$types);return n},validators:function(e){var t,n=this;if(Z(e,z))for(t in e)e[le](t)&&kt(n,t,e[t],n.$validators);return n},getters:function(e){var t,n=this;if(Z(e,z))for(t in e)e[le](t)&&wt(n,t,e[t],n.$getters);return n},setters:function(e){var t,n=this;if(Z(e,z))for(t in e)e[le](t)&&wt(n,t,e[t],n.$setters);return n},serialize:function(){return Tt(this,Lt)},typecast:function(e){return xt(this,Lt,e),this},validate:function(e,t){return St(this,Lt,!!e,t)},autovalidate:function(e){var t=this;return arguments.length?(t.$autovalidate=!!e,t):t.$autovalidate},has:function(e,t){var n,i=this,r=i.$data,l=i.$getters;return 0>e.indexOf(".")&&(r[le](e)||!t&&(n=l[e]||l[Ke])&&n.v)?!0:(n=ht(e.split("."),r,t?null:l,Lt))?!0===n?!0:n[1].has(n[2].join(".")):!1},get:function(e,t){var n,i=this,r=i.$data,l=i.$getters;return 0>e.indexOf(".")?!t&&(n=l[e]||l[Ke])&&n.v?n.v.call(i,e):r[e]:(n=pt(e.split("."),r,t?null:l,Lt))?Lt===n[0]?n[1].get(n[2].join("."),t):!1===n[0]?n[1].call(i,e):n[1]:u},getAll:function(e,t){var n,i,r,l,o,a,u,s,c,f,d,h,p,v,g,m,b,y=this,_=[];if(!e||!e.length)return _;for(e.substr&&(e=[e]),t=!0===t,v=y.$data,d=t?null:[y.$getters],l=0,o=e.length;o>l;l++)for(b=e[l],g=[[v,b,d]];g.length;)for(m=g.pop(),c=m[0],b=m[1],h=m[2],a=b.split("."),s=0,u=a.length;u>s;)if(r=a[s++],u>s)if(f=Y(c),f&z){if(Ke===r){for(r=a.slice(s).join("."),n=$(c),i=0;i<n.length;i++)g.push([c,n[i]+"."+r,ct(h,n[i])]);break}c[le](r)&&(c=c[r],h=ct(h,r))}else{if(!(f&H))break;if(Ke===r){for(r=a.slice(s).join("."),i=0;i<c.length;i++)g.push([c,""+i+"."+r,ct(h,""+i)]);break}c[le](r)&&(c=c[r],h=ct(h,r))}else if(f=Y(c),f&z)if(Ke===r)for(n=$(c),i=0;i<n.length;i++)t?_.push(c[n[i]]):(p=ft(h,n[i]))||(p=ft(h,r))?_.push(p.call(y,c[n[i]])):_.push(c[n[i]]);else!t&&(p=ft(h,r))?_.push(p.call(y,c[r])):c[le](r)&&_.push(c[r]);else if(f&H)if(Ke===r)for(i=0;i<c.length;i++)t?_.push(c[i]):(p=ft(h,i))||(p=ft(h,r))?_.push(p.call(y,c[i])):_.push(c[i]);else!t&&(p=ft(h,r))?_.push(p.call(y,c[r])):c[le](r)&&_.push(c[r]);return _},set:function(e,t,n,i){var r,l,o,a,u,s,c,f,d,h,p,v,g,$,m,b=this,y=null,_=null,k=!1,w=!1,E=b.$autovalidate;if(b.atomic&&Te(e,b.$atom))return b;if(o=b.$data,h=b.$types,p=b.$validators,v=b.$setters,g=b.$idependencies,k=H&Y(t),0>e.indexOf("."))a=e,d=(r=v[a])?r.v:null,c=(r=h[a]||h[Ke])?r.v:null,f=E&&(r=p[a]||p[Ke])?r.v:null,k&&(c||(y=(l=h[a]||h[Ke])&&l.n[Ke]?l.n[Ke].v:null),E&&!f&&(_=(l=p[a]||p[Ke])&&l.n[Ke]?l.n[Ke].v:null)),w=!0;else if(r=gt(e.split("."),o,h,E?p:null,v,Lt)){if(o=r[1],a=r[2],Lt===r[0])return a.length?(a=a.join("."),$=o.get(a),$!==t?o.set(a,t,n,i):n=!1):($=o.data(),$!==t?o.data(t):n=!1),n&&(b.publish("change",{key:e,value:t,action:"set",valuePrev:$,$callData:i}),g[le](e)&&b.notify(g[e])),b;if(d=ft(r[6],a),!d&&!1===r[0]&&r[3].length)return b;c=ft(r[4],a),f=ft(r[5],a),k&&(c||(y=ft(ct(r[4],a),Ke)),E&&!f&&(_=ft(ct(r[5],a),Ke))),w=!0}if(w){if(c)t=c.call(b,t,e);else if(y)for(u=0,s=t.length;s>u;u++)t[u]=y.call(b,t[u],e);if(m=!0,f)m=f.call(b,t,e);else if(_)for(u=0,s=t.length;s>u;u++)if(!_.call(b,t[u],e)){m=!1;break}if(!m)return n&&(i&&(i.error=!0),b.publish("error",{key:e,value:o[a],action:"set",$callData:i})),b;if(d)return!1!==d.call(b,e,t,n)&&(n&&(b.publish("change",{key:e,value:t,action:"set",$callData:i}),g[le](e)&&b.notify(g[e])),b.$atom&&e===b.$atom&&(b.atomic=!0)),b;$=o[a],$!==t&&(o[a]=t,n&&(b.publish("change",{key:e,value:t,valuePrev:$,action:"set",$callData:i}),g[le](e)&&b.notify(g[e])),b.$atom&&e===b.$atom&&(b.atomic=!0))}return b},add:function(e,t,n,i){var r,l,o,a,s,c,f,d,h,p,v,g,$,m=this,b=-1,y=null,_=null,k=!1,w=!1,E=m.$autovalidate;if(m.atomic&&Te(e,m.$atom))return m;if(l=m.$data,h=m.$types,p=m.$validators,v=m.$setters,g=m.$idependencies,k=H&Y(t),0>e.indexOf("."))o=e,d=(r=v[o])&&r.n[Ke]?r.n[Ke].v:null,c=(r=h[o]||h[Ke])&&r.n[Ke]?r.n[Ke].v:null,f=E&&(r=p[o]||p[Ke])&&r.n[Ke]?r.n[Ke].v:null,k&&(c||(y=ft(ct(ct([h[o]||h[Ke]],Ke),Ke),Ke)),E&&!f&&(_=ft(ct(ct([p[o]||p[Ke]],Ke),Ke),Ke))),w=!0;else if(r=gt(e.split("."),l,h,E?p:null,v,Lt)){if(l=r[1],o=r[2],Lt===r[0])return o.length?(o=o.join("."),l.add(o,t,n,i)):(b=0,l.data(t)),n&&(m.publish("change",{key:e,value:t,action:"append",index:b,$callData:i}),g[le](e)&&m.notify(g[e])),m;if(d=ft(ct(r[6],o),Ke),!d&&!1===r[0]&&r[3].length)return m;c=ft(ct(r[4],o),Ke),f=ft(ct(r[5],o),Ke),k&&(c||(y=ft(ct(ct(r[4],o),Ke),Ke)),E&&!f&&(_=ft(ct(ct(r[5],o),Ke),Ke))),w=!0}if(w){if(c)t=c.call(m,t,e);else if(y)for(a=0,s=t.length;s>a;a++)t[a]=y.call(m,t[a],e);if($=!0,f)$=f.call(m,t,e);else if(_)for(a=0,s=t.length;s>a;a++)if(!_.call(m,t[a],e)){$=!1;break}if(!$)return n&&(i&&(i.error=!0),m.publish("error",{key:e,value:u,action:"append",index:-1,$callData:i})),m;if(d)return!1!==d.call(m,e,t,n)&&(n&&(H===Y(l[o])&&(b=l[o].length),m.publish("change",{key:e,value:t,action:"append",index:b,$callData:i}),g[le](e)&&m.notify(g[e])),m.$atom&&e===m.$atom&&(m.atomic=!0)),m;H===Y(l[o])?(b=l[o].length,l[o].push(t)):(b=-1,l[o]=t),n&&(m.publish("change",{key:e,value:t,action:"append",index:b,$callData:i}),g[le](e)&&m.notify(g[e])),m.$atom&&e===m.$atom&&(m.atomic=!0)}return m},ins:function(e,t,n,i,r){var l,o,a,s,c,f,d,h,p,v,g,$,m,b=this,y=null,_=null,k=!1,w=!1,E=b.$autovalidate;if(b.atomic&&Te(e,b.$atom))return b;if(o=b.$data,p=b.$types,v=b.$validators,g=b.$setters,$=b.$idependencies,k=H&Y(t),0>e.indexOf("."))a=e,h=(l=g[a])&&l.n[Ke]?l.n[Ke].v:null,f=(l=p[a]||p[Ke])&&l.n[Ke]?l.n[Ke].v:null,d=E&&(l=v[a]||v[Ke])&&l.n[Ke]?l.n[Ke].v:null,w=!0,k&&(f||(y=ft(ct(ct([p[a]||p[Ke]],Ke),Ke),Ke)),E&&!d&&(_=ft(ct(ct([v[a]||v[Ke]],Ke),Ke),Ke)));else if(l=gt(e.split("."),o,p,E?v:null,g,Lt)){
if(o=l[1],a=l[2],Lt===l[0])return a.length?(a=a.join("."),o.ins(a,t,n,i,r)):o.data(t),i&&(b.publish("change",{key:e,value:t,action:"insert",index:n,$callData:r}),$[le](e)&&b.notify($[e])),b;if(h=ft(ct(l[6],a),Ke),!h&&!1===l[0]&&l[3].length)return b;f=ft(ct(l[4],a),Ke),d=ft(ct(l[5],a),Ke),k&&(f||(y=ft(ct(ct(l[4],a),Ke),Ke)),E&&!d&&(_=ft(ct(ct(l[5],a),Ke),Ke))),w=!0}if(w){if(f)t=f.call(b,t,e);else if(y)for(s=0,c=t.length;c>s;s++)t[s]=y.call(b,t[s],e);if(m=!0,d)m=d.call(b,t,e);else if(_)for(s=0,c=t.length;c>s;s++)if(!_.call(b,t[s],e)){m=!1;break}if(!m)return i&&(r&&(r.error=!0),b.publish("error",{key:e,value:u,action:"insert",index:-1,$callData:r})),b;if(h)return!1!==h.call(b,e,t,i)&&(i&&(b.publish("change",{key:e,value:t,action:"insert",index:n,$callData:r}),$[le](e)&&b.notify($[e])),b.$atom&&e===b.$atom&&(b.atomic=!0)),b;H===Y(o[a])?o[a].splice(n,0,t):(n=-1,o[a]=t),i&&(b.publish("change",{key:e,value:t,action:"insert",index:n,$callData:r}),$[le](e)&&b.notify($[e])),b.$atom&&e===b.$atom&&(b.atomic=!0)}return b},del:function(e,t,n,i){var r,l,o,a,s=this,c=-1,f=!1;if(s.atomic&&Te(e,s.$atom))return s;if(n=!1!==n,l=s.$data,0>e.indexOf("."))o=e,f=!0;else if(r=gt(e.split("."),l,null,null,null,Lt,!1)){if(l=r[1],o=r[2],Lt===r[0]&&o.length)return o=o.join("."),a=l.get(o),l.del(o,n,t,i),t&&s.publish("change",{key:e,value:a,action:"delete",index:c,rearrange:n,$callData:i}),s.$atom&&e===s.$atom&&(s.atomic=!0),s;if(r[3].length)return s;f=!0}return f&&(a=l[o],l[o]=u,n?(T=Y(l),H==T&&J(o)?(c=+o,l.splice(c,1)):z==T&&delete l[o]):delete l[o],t&&s.publish("change",{key:e,value:a,action:"delete",index:c,rearrange:n,$callData:i}),s.$atom&&e===s.$atom&&(s.atomic=!0)),s},delAll:function(e,t){var n,i,r,l,o,a,u,s,c,f,d,h,p,v,g=this;if(!e||!e.length)return g;for(e.substr&&(e=[e]),t=!1!==t,d=g.$data,l=0,o=e.length;o>l;l++)for(v=e[l],h=[[d,v]];h.length;)for(p=h.pop(),c=p[0],v=p[1],a=v.split("."),s=0,u=a.length;u>s;)if(r=a[s++],u>s)if(f=Y(c),f&z){if(Ke===r){for(r=a.slice(s).join("."),n=$(c),i=0;i<n.length;i++)h.push([c,n[i]+"."+r]);break}c[le](r)&&(c=c[r])}else{if(!(f&H))break;if(Ke===r){for(r=a.slice(s).join("."),i=0;i<c.length;i++)h.push([c,""+i+"."+r]);break}c[le](r)&&(c=c[r])}else if(f=Y(c),f&z)if(Ke===r)for(n=$(c),i=0;i<n.length;i++)delete c[n[i]];else c[le](r)&&delete c[r];else if(f&H)if(Ke===r)for(i=c.length-1;i>=0;i--)t?c.splice(i,1):delete c[i];else c[le](r)&&(t&&J(r)?c.splice(+r,1):delete c[r]);return g},sync:function(e,t){var n,i,r,l,o,a,u=this;for(n in t)if(t[le](n)){for(i=t[n],u.$syncTo[n]=u.$syncTo[n]||[],r=null,H===Y(i)&&(r=i[1]||null,i=i[0]),l=u.$syncTo[n],a=1,o=l.length-1;o>=0;o--)if(e===l[o][0]&&i===l[o][1]){l[o][2]=r,a=0;break}a&&l.push([e,i,r])}return u.$syncHandler||(u.__syncing=u.__syncing||{},u.on("change",u.$syncHandler=Ct)),u},unsync:function(e){var t,n,i,r=this,l=r.$syncTo;for(t in l)if(l[le](t)){if(!(n=l[t])||!n.length)continue;for(i=n.length-1;i>=0;i--)e===n[i][0]&&(r.__syncing&&r.__syncing[e.$id]&&O(r.__syncing,e.$id),n.splice(i,1))}return r},notify:function(e,t,n){var i,r,l,o,a,u,s=this,c=s.$idependencies,f=[],d={};if(e){if(a=Y(e),t=t||"change",l={key:"",action:"set"},n&&(n[le]("value")&&(l.value=n.value),n[le]("action")&&(l.action=n.action),n[le]("index")&&(l.index=n.index),n[le]("rearrange")&&(l.rearrange=n.rearrange),n[le]("$callData")&&(l.$callData=n.$callData)),R===a)l.key=e,d["_"+e]=1,c[le](e)&&(f=f.concat(c[e])),s.publish(t,l);else if(H===a)for(r=e.length,i=0;r>i;i++)l.key=o=e[i],d[le]("_"+o)||(d["_"+o]=1,c[le](o)&&(f=f.concat(c[o])),s.publish(t,l));for(;r=f.length;){for(u=[],l={key:"",action:"set"},i=0;r>i;i++)o=f[i],d[le]("_"+o)||(d["_"+o]=1,c[le](o)&&(u=u.concat(c[o])),l.key=o,s.publish("change",l));f=u}}return s},atom:function(e){var t=this;return u!==e&&(!1===e?(t.atomic=!1,t.$atom=null):(t.atomic=!1,t.$atom=e)),t},toString:function(){return"[ModelView.Model id: "+this.id+"]"}}),Lt[c].append=Lt[c].add,Lt[c].insert=Lt[c].ins,Lt[c].remove=Lt[c]["delete"]=Lt[c].del,Lt[c].deleteAll=Lt[c].delAll;var Ot="lastIndexOf",jt="match",Mt="nodeValue",Nt="nodeType",Dt="parentNode",At="global",Vt="ignoreCase",Pt=/[a-zA-Z0-9_\-]/,Rt=function(e){return parseInt(e,10)},It=function(e,t,n){for(var i,r,l,o,a,s,c,f,d,h,p=[],v=0,g=!1,$=-1,m=0,b=!1,y={};i=t.exec(e);){if(r=t.lastIndex-i[0].length,l=e.slice(v,r),d=-1,n&&(c=l[Ot]("<"),f=l[Ot](">"),c>f?(d=-1,b=!0):f>c&&(d=f+1,b=!1)),p.push([1,b,l,d]),b)if(-1<(a=l[Ot]("="))){for(g="",s=a;a>-1&&Pt.test(o=l.charAt(--a));)g=o+g;$=r-v-s-2,m=$+i[0].length}else g&&($=m+r-v-2-1,m+=$+i[0].length);else g=!1,m=0,$=-1;h=i[1]?i[1]:i[0],y[le](h)?y[h].push(p.length):y[h]=[p.length],p.push([0,b,h,u,g,$]),v=t.lastIndex}return l=e.slice(v),d=-1,n&&(c=l[Ot]("<"),f=l[Ot](">"),c>f?(d=-1,b=!0):f>c&&(d=f+1,b=!1)),p.push([1,b,l,d]),[y,p]},Ht=function(e,t,n){var i,r,l,o,a,u,s,c,f,d,h,p,v,g,$,m,b,y,_,k,w;if(r=[],l=[],d=e,d.attributes&&(a=d.attributes.length))if(n&&d.firstChild&&8===d.firstChild[Nt]&&"att:"===d.firstChild[Mt].slice(0,4))for(c=d.firstChild[Mt].split("\n"),a=c.length,g={},o=0;a>o;o++)u=c[o].split("|"),b=u[0].slice(4),h=d.attributes[b],g[le](b)||(g[b]=[1,[]],l.push([h,g[b],d])),g[b][1].push([u[1].slice(4),u[2].split(",").map(Rt)]);else for(o=0;a>o;o++)h=d.attributes[o],(u=h[Mt][jt](t))&&l.push([0,h,u,d]);if(3===d[Nt])n&&d.previousSibling&&d.nextSibling&&8===d.previousSibling[Nt]&&8===d.nextSibling[Nt]&&"key:"===(p=d.previousSibling[Mt]).slice(0,4)&&"/key"===d.nextSibling[Mt]?(u=[d[Mt],p.slice(4)],r.push([d,u,d[Dt]])):(u=d[Mt][jt](t))&&r.push([d,u,d[Dt]]);else if(d.firstChild)for(w=[d=d.firstChild];w.length;){if(d.attributes&&(a=d.attributes.length))if(n&&d.firstChild&&8===d.firstChild[Nt]&&"att:"===d.firstChild[Mt].slice(0,4))for(c=d.firstChild[Mt].split("\n"),a=c.length,g={},o=0;a>o;o++)u=c[o].split("|"),b=u[0].slice(4),h=d.attributes[b],g[le](b)||(g[b]=[1,[]],l.push([h,g[b],d])),g[b][1].push([u[1].slice(4),u[2].split(",").map(Rt)]);else for(o=0;a>o;o++)h=d.attributes[o],(u=h[Mt][jt](t))&&l.push([h,u,d]);if(d.firstChild)w.push(d=d.firstChild);else{for(3===d[Nt]&&(n&&d.previousSibling&&d.nextSibling&&8===d.previousSibling[Nt]&&8===d.nextSibling[Nt]&&"key:"===(p=d.previousSibling[Mt]).slice(0,4)&&"/key"===d.nextSibling[Mt]?(u=[d[Mt],p.slice(4)],r.push([d,u,d[Dt]])):(u=d[Mt][jt](t))&&r.push([d,u,d[Dt]])),d=w.pop();w.length&&!d.nextSibling;)d=w.pop();d.nextSibling&&w.push(d=d.nextSibling)}}for(i={},o=0,a=r.length;a>o;o++)if(s=r[o],k=s[0],u=s[1],d=s[2],m=k[Mt],m.length>u[0].length){do p=u[1]?u[1]:u[0],v=k.splitText(u.index),k=v.splitText(u[0].length),i[le](p)?i[p][0].push([v,d]):i[p]=[[[v,d]],[]],u=k[Mt][jt](t);while(u)}else p=u[1]?u[1]:u[0],v=k,i[le](p)?i[p][0].push([v,d]):i[p]=[[[v,d]],[]];for(o=0,a=l.length;a>o;o++)if(s=l[o],h=s[0],u=s[1],d=s[2],m=h[Mt],k=document.createTextNode(m||""),$=[[],[k]],1===u[0])for(c=u[1],f=c.length,_=0,o=0;f>o;o++)y=c[o],p=y[0],v=k.splitText(y[1][0]-_),k=v.splitText(y[1][1]),$[0].push(p),$[1].push(v,k),i[le](p)?(i[p][0].push([v,d]),i[p][1].push([h,$[1],m,d])):i[p]=[[[v,d]],[[h,$[1],m,d]]],_+=y[1][1]+y[1][0];else if(m.length>u[0].length){do p=u[1]?u[1]:u[0],v=k.splitText(u.index),k=v.splitText(u[0].length),$[0].push(p),$[1].push(v,k),i[le](p)?(i[p][0].push([v,d]),i[p][1].push([h,$[1],m,d])):i[p]=[[[v,d]],[[h,$[1],m,d]]],u=k[Mt][jt](t);while(u)}else v=k,p=u[1]?u[1]:u[0],$[0].push(p),i[le](p)?(i[p][0].push([v,d]),i[p][1].push([h,$[1],m,d])):i[p]=[[[v,d]],[[h,$[1],m,d]]];return[i,e]},zt=function(e){var t,n,i,r,l,o=this.$tpl[1],a=this.$revivable,u=o.length,s=[],c="";for(n=0;u>n;n++)t=o[n],i=t[0],l=t[1],r=t[2],i?(a&&!l&&t[3]>-1&&s.length&&(r=r.slice(0,t[3])+"<!--"+s.join("\n")+"-->"+r.slice(t[3]),s=[]),c+=r):(e[le](r)&&(t[3]=String(e[r])),a?l?(c+=t[3],t[4]&&s.push("att:"+t[4]+"|key:"+r+"|"+[t[5],t[3].length].join(","))):c+="<!--key:"+r+"-->"+t[3]+"<!--/key-->":c+=t[3]);return c},Ft=function(e){var t,n,i,r,l,o,a,u,s,c,f,d,h,p,v=this.$tpl[0];for(r=$(e),a=r.length,o=0;a>o;o++)if(l=r[o],u=String(e[l]),v[le](l)){for(s=v[l][0],n=0,i=s.length;i>n;n++)s[n][0][Mt]=u;for(c=v[l][1],n=0,i=c.length;i>n;n++){if(t=c[n],f=t[1],h=f.length,p=h?f[0][Mt]:"",h>1)for(d=1;h>d;d++)p+=f[d][Mt];t[0][Mt]=p}}return this},Bt=function $n(e,t,n){var i=this;return i instanceof $n?(i.initPubSub(),i.$revivable=!0===n,void(e.substr&&e.substring?(i.$key=t[At]?t:new RegExp(t.source,t[Vt]?"gi":"g"),i.$tpl=$n.multisplit_string(e,i.$key,i.$revivable),i.render=zt):(i.$key=t[At]?new RegExp(t.source,t[Vt]?"i":""):t,i.$tpl=Ht(e,i.$key,i.$revivable),i.render=Ft))):new $n(e,t,n)};Bt.multisplit_string=It,Bt.multisplit_node=Ht,Bt[c]=re(g(p[c]),nt,{constructor:Bt,id:null,$tpl:null,$key:null,$revivable:!1,dispose:function(){var e=this;return e.disposePubSub(),e.$key=null,e.$tpl=null,e.$revivable=null,e},keys:function(){return $(this.$tpl[0])},render:function(e){},bind:function(e){var t=this;if(e){var n,i=t.$tpl[0],r=Ht(e,t.$key,!1)[0];for(n in r)r[le](n)&&(i[le](n)?(i[n][0]=i[n][0].concat(r[n][0]),i[n][1]=i[n][1].concat(r[n][1])):i[n]=r[n])}return t},free:function(e){var t=this;if(e){var n,i,r,l,o,a,u,s=t.$tpl[0],c=$(s),f=c.length;for(l=0;f>l;l++){for(n=c[l],o=s[n],a=o[0],r=a.length,i=r-1;i>=0;i--)e.contains(a[i][1])&&a.splice(i,1);for(u=o[1],r=u.length,i=r-1;i>=0;i--)e.contains(u[i][3])&&u.splice(i,1)}}return t},toString:function(){return"[ModelView.Tpl id: "+this.id+"]"}});var Ut="mv_namedkey",Xt=function(e,t){if(e)for(var n=0,i=e.length;i>n;n++)if(t==b(e[n]))return!0;return!1},qt=function(e,t){return new h(L(e).replace("__MODEL__",L(t||"")).replace("__KEY__","(\\S+?)"),"")},Wt=function(e,t,n){return[e?"["+e+"]":null,t?t[1]?"["+t[0]+'*="|'+t[1]+'"]':"["+t[0]+"]":null,n?n[1]?'input[name="'+n[0]+'"],textarea[name="'+n[0]+'"],select[name="'+n[0]+'"]':'input[name^="'+n[0]+'"],textarea[name^="'+n[0]+'"],select[name^="'+n[0]+'"]':null]},Kt=function(e,t){return t&&t[e]?(Z(t[e],R)&&(t[e]={action:t[e]}),t[e]):void 0},Qt=/^\d+$/,Yt=/\[\s*\]$/,Zt=function(e,t){var n=e.$model,i=n.id+".",r={};ie(function(l){var o,a,u,s,c,f,d,h,p,v,g;if(o=t[l],a=o[oe]("name"))for(p=(o[pe]||"").toLowerCase(),u=bt(a),Te(u,i)&&(u=u.slice(i.length)),s=u.split("."),f=n.$data;s.length;)c=s.shift(),s.length?(f[le](c)||(f[c]=Qt.test(s[0])?[]:{}),f=f[c]):"radio"===p?r[a]||(h="",g=e.get('input[type="radio"][name="'+a+'"]',0,1),g.length>1?ne(g,function(e){o[se]&&(h=o[ve])}):o[se]&&(h=o[ve]),r[a]=1,n.set(u,h)):"checkbox"===p?r[a]||(v=Yt.test(a),g=e.get('input[type="checkbox"][name="'+a+'"]',0,1),v?(h=[],ne(g,function(e){e[se]&&h.push(e[ve])})):g.length>1?(h=[],ne(g,function(e){e[se]?h.push(e[ve]):h.push((d=e[oe]("data-else"))?d:"")})):h=o[se]?o[ve]:(d=o[oe]("data-else"))?d:"",r[a]=1,n.set(u,h)):(h=ze(o),n.set(u,h))},0,t.length-1)},Gt=function(e,t){var n={},i=t&&t.length?t+".":null,r=Me("input,textarea,select",e),l={};return ie(function(t){var o,a,u,s,c,f,d,h,p,v;if(o=r[t],a=o[oe]("name")){if(h=(o[pe]||"").toLowerCase(),u=bt(a),i){if(!Te(u,i))return;u=u.slice(i.length)}for(s=u.split("."),f=n;s.length;)c=s.shift(),s.length?(f[le](c)||(f[c]=Qt.test(s[0])?[]:{}),f=f[c]):(f[le](c)||(f[c]=""),"radio"===h?l[a]||(d="",v=Me('input[type="radio"][name="'+a+'"]',e),v.length>1?ne(v,function(e){o[se]&&(d=o[ve])}):o[se]&&(d=o[ve]),l[a]=1,f[c]=d):"checkbox"===h?l[a]||(p=Yt.test(a),v=Me('input[type="radio"][name="'+a+'"]',e),p?(d=[],ne(v,function(e){e[se]&&d.push(e[ve])})):v.length>1?(d=[],ne(v,function(e){e[se]?d.push(e[ve]):d.push((alternative=e[oe]("data-else"))?alternative:"")})):d=o[se]?o[ve]:(alternative=o[oe]("data-else"))?alternative:"",l[a]=1,f[c]=d):(d=ze(o),f[c]=d))}},0,r.length-1),n},Jt=function(e,t,n,i){var r=e.$model,l="sync"==t.type,o=l?"change":t.type,a=i&&i.key?i.key:null,u=!a,s=a?a+".":null,c=r.atomic,f=r.$atom,d=c?f+".":null;ie(function(i){var l,h,p,v,g;l=n[i],l&&(h=Kt(o,e.attr(l,"bind")),h&&h[le]("action")&&(p="do_"+h.action,Z(e[p],F)&&(v=l[de],g=h.key,g||(!l[Ut]&&v&&(l[Ut]=r.key(v,1)),g=l[Ut]),c&&g&&(f===g||Te(g,d))||a&&!g||(u||g===a||Te(g,s))&&e[p](t,l,h))))},0,n.length-1)},en=function(e,t,n,i){var r=e.$model,l={};ie(function(i){var o,a,u,s,c;if(o=n[i],o&&(a=o[de],u=0,!o[Ut]&&a&&(o[Ut]=r.key(a,1)),u=o[Ut])){if(s="_"+u,l[le](s))c=l[s][0];else{if(!r.has(u))return;l[s]=[c=r.get(u)]}e.do_bind(t,o,{name:a,key:u,value:c})}},0,n.length-1)},tn=function(e,t,n){var i,r,l=e.$model,o="sync"==t.type,a=!1,u=e.$tpl.keys(),s=u.length,c={};o?ie(function(e){var t=u[e];c[t]=l.get(t),a=!0},0,s-1):n&&n.key&&(i=n.key,r=i+".",ie(function(e){var t=u[e];(i===t||Te(t,r))&&(c[t]=l.get(t),a=!0)},0,s-1)),a&&e.$tpl.render(c)},nn={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},rn={27:"escape",9:"tab",32:"space",13:"enter",8:"backspace",145:"scrolllock",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"delete",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},ln=function(e,t){return function(n){return e[t](n,{el:this})}},on=function mn(e,t,n,i,r){var l=this;return l instanceof mn?(l.namespace=l.id=e||Ze("View"),(n=n||{})[le]("bind")||(n.bind="data-bind"),l.$atts=n,i=i||mn._CACHE_SIZE,r=r||mn._REFRESH_INTERVAL,l.$memoize=new it(i,S),l.$selectors=new it(i,r),l.$atbind=l.attribute("bind"),l.$shortcuts={},l.$num_shortcuts=0,void l.model(t||new Lt).initPubSub()):new mn(e,t,n,i,r)};return on._CACHE_SIZE=600,on._REFRESH_INTERVAL=S,on.node=Oe,on.index=Ce,on.indexClosest=Le,on.getDomRef=Ne,on.serialize=Gt,on[c]=re(g(p[c]),nt,{constructor:on,id:null,$dom:null,$tpl:null,$model:null,$livebind:null,$autobind:!1,$isomorphic:!1,$bindbubble:!1,$template:null,$atts:null,$memoize:null,$selectors:null,$atbind:null,$shortcuts:null,$num_shortcuts:null,dispose:function(){var e=this;return e.unbind().disposePubSub(),e.$model&&e.$model.dispose(),e.$model=null,e.$dom=null,e.$tpl&&e.$tpl.dispose(),e.$tpl=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.$livebind=null,e.$isomorphic=null,e.$atbind=null,e.$shortcuts=null,e.$num_shortcuts=null,e},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var n=this;return arguments.length>1?(n.$atts[e]=t,n.$atbind=n.$atts.bind,n.$atkeys=n.$atts.keys,n):e?n.$atts[e]||u:u},template:function(e){var t=this;return arguments.length?(Z(e,F)&&(t.$template=e),t):t.$template},events:function(e){var t,n=this;if(Z(e,z))for(t in e)e[le](t)&&Z(e[t],F)&&(n["on_"+t.split(":").join("_")]=e[t]);return n},shortcuts:function(e){var t,n,i,r,l,o=this,a=o.$shortcuts;if(Z(e,z))for(t in e)if(e[le](t)){for(r=[],i=t.toLowerCase().split("+").map(Ee),l=i.length-1;l>=0;l--)n=i[l],"alt"!==n&&"ctrl"!==n&&"shift"!==n&&"meta"!==n||(r.push(n),i.splice(l,1));n=r.sort().concat(i).join("+"),!1===e[t]?a[le](n)&&(O(a,n),o.$num_shortcuts--):(a[le](n)||o.$num_shortcuts++,a[n]=e[t])}return o},actions:function(e){var t,n=this;if(Z(e,z))for(t in e)e[le](t)&&Z(e[t],F)&&(n["do_"+t]=e[t]);return n},autovalidate:function(e){return arguments.length?(this.$model.autovalidate(e),this):this.$model.autovalidate()},livebind:function(e){var t=this;return arguments.length?(t.$livebind=e?qt(e,t.$model?t.$model.id:""):null,t):t.$livebind},isomorphic:function(e){var t=this;return arguments.length?(t.$isomorphic=!!e,t):t.$isomorphic},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},get:function(e,t,n,i){var r,l=this,o=l.$selectors;return t=t||l.$dom,!i&&(r=o.get(e))||(r=Me(e,t),n&&t[De](e)&&r.push(t),i||o.set(e,r)),r},attr:function(e,t){var n,i,r=this,l=r.$atts[t],o=r.$memoize;return(l=e[oe](l))?(n=o.get(l),u===n&&(n=we(l),n.set&&(n.click=n.set,n.click.action="set",O(n,"set")),n.each&&(n.change={action:"each",key:n.each},O(n,"each")),n.show&&(n.change={action:"show",key:n.show},O(n,"show")),n.hide&&(n.change={action:"hide",key:n.hide},O(n,"hide")),n.html?(n.change={action:"html",key:n.html},O(n,"html"),O(n,"text")):n.text&&(n.change={action:"html",key:n.text,text:1},O(n,"text")),n.css&&(n.change={action:"css",css:n.css},O(n,"css")),n.value&&(n.change&&"prop"==n.change.action?n.change.prop.value=n.value:n.change={action:"prop",prop:{value:n.value}},O(n,"value")),n.checked&&(n.change&&"prop"==n.change.action?n.change.prop.checked=n.checked:n.change={action:"prop",prop:{checked:n.checked}},O(n,"checked")),n.disabled&&(n.change&&"prop"==n.change.action?n.change.prop.disabled=n.disabled:n.change={action:"prop",prop:{disabled:n.disabled}},O(n,"disabled")),n.options&&(n.change&&"prop"==n.change.action?n.change.prop.options=n.options:n.change={action:"prop",prop:{options:n.options}},O(n,"options")),(i=n.change)&&!i.key&&n.key&&(i.key=n.key),o.set(l,n)),n):u},add:function(e,t){var n=this;return e&&(n.$tpl&&n.$tpl.bind(e),!1!==t&&n.sync(null,e)),n},remove:function(e,t){var n=this;return e&&(n.$tpl&&n.$tpl.free(e),!1!==t&&n.$selectors.reset()),n},bind:function(e,n){var i,r,l,o=this,u=o.$model,s=Wt(o.$atbind,null,[u.id+"["]),c=s[0],f=s[2],d=o.$autobind,h=!!o.$livebind,p="undefined"!=typeof document;e=e||["change","click"],o.$dom=n||(p?document.body:null),l=function(e){return t(e,o.namespace)},h&&(o.$tpl=Bt(o.$dom,o.$livebind,o.$isomorphic)),p&&o.on_view_change&&e.length&&a(o.$dom).on(ee(e,l).join(" "),d?[f,c].join(","):c,function(e){var t=this,n=!1,i=!1,r=o.$bindbubble?o.attr(t,"bind"):null;return(e.target===t||r&&r.bubble)&&(i=o.$bindbubble?!!r:t[De](c),n=d&&"change"==e.type&&t[De](f),(i||n)&&o.on_view_change(e,{el:t,isBind:i,isAutoBind:n})),!0});for(i in o)Z(o[i],F)&&(Te(i,"on_model_")?(r=i.slice(9),r.length&&o.onTo(u,r,o[i])):p&&(Te(i,"on_document_")?(r=i.slice(12),r.length&&a(document.body).on(l(r),ln(o,i))):Te(i,"on_view_")&&"on_view_change"!==i?(r=i.slice(8),r.length&&a(o.$dom).on(l(r),d?[f,c].join(","):c,ln(o,i))):Te(i,"on_dom_")&&(r=i.slice(7),r.length&&a(o.$dom).on(l(r),ln(o,i)))));return o},unbind:function(e,n){var i,r,l=this,o=l.$model,u=Wt(l.$atbind,null,[o.id+"["]),s=t("",l.namespace),c=l.$autobind,f=(!!l.$livebind,"undefined"!=typeof document);return e=e||null,r=n||l.$dom,i=function(e){return t(e,l.namespace)},f&&l.on_view_change&&a(r).off(e&&e.length?ee(e,i).join(" "):s,c?[u[2],u[0]].join(","):u[0]),l.offFrom(o),f&&(a(r).off(s),a(document.body).off(s)),l.$tpl&&(l.$tpl.dispose(),l.$tpl=null),l},rebind:function(e,t){var n=this;return n.$memoize.reset(),n.$selectors.reset(),n.unbind().bind(e,t)},sync:function(e,t){var n,i,r,l=this,o=l.$autobind,a=!!l.$livebind,u=Wt(l.$atbind,null,o?[l.$model.id+"["]:0),s=tt("sync",l),c="undefined"!=typeof document;return l.$selectors.reset(),t?(s.currentTarget=t,c&&(n=l.get(u[0],t,0,1),o&&(i=l.get(u[2],t,0,1)))):c&&(e=e||l.$dom,r=!(e===l.$dom),n=l.get(u[0],e,0,r),o&&(i=l.get(u[2],e,0,r))),c&&n.length&&Jt(l,s,n),c&&o&&i.length&&en(l,s,i),a&&l.$tpl&&tn(l,s),l},sync_model:function(e){var t,n,i=this,r=i.$autobind,l="undefined"!=typeof document;return l&&r&&(t=Wt(null,null,[i.$model.id+"["]),i.$selectors.reset(),n=i.get(t[2],e||i.$dom,0,1),n.length&&Zt(i,n)),i},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},on_view_change:function(e,t){var n,i,r,l,o,a,u,s=this,c=s.$model,f=t.el,d={};t.isAutoBind&&(n=f[de])&&(f[Ut]||(f[Ut]=c.key(n,1)),i=f[Ut],i&&(a=f[pe].toLowerCase(),"checkbox"===a?(o=Yt.test(n),l=s.get('input[type="checkbox"][name="'+n+'"]'),o?(r=[],ne(l,function(e){e[se]&&r.push(e[ve])})):l.length>1?(r=[],ne(l,function(e){e[se]?r.push(e[ve]):r.push((u=e[oe]("data-else"))?u:"")})):r=f[se]?f[ve]:(u=f[oe]("data-else"))?u:""):r=ze(f),d.$trigger=f,c.set(i,r,1,d))),!d.error&&t.isBind&&Jt(s,e,[f]),s.publish("change",t)},on_document_keydown:function(e,t){var n,i,r,l,o,a,u,s=this,c=s.$shortcuts,f=t.el;return r="TEXTAREA"===f.tagName?"text":"INPUT"===f.tagName?f[pe].toLowerCase():"",s.$num_shortcuts&&"text"!==r&&"email"!==r&&"url"!==r&&"number"!==r?(o=e.keyCode||e.which,u=[],e.altKey&&u.push("alt"),e.ctrlKey&&u.push("ctrl"),e.metaKey&&u.push("meta"),e.shiftKey&&u.push("shift"),rn[le](o)?l=rn[o]:(a=188===o?",":190===o?".":b.fromCharCode(o).toLowerCase(),e.shiftKey&&nn[le](a)&&(a=nn[a]),l=a),l=u.concat(l).join("+"),l&&c[le](l)&&c[l]&&(n=c[l],i=!0,n.substr?Z(s["do_"+n],F)&&(s["do_"+n](e,f,{}),i=!1):i=n.call(s,e,f,{}),!1===i)?(e.stopPropagation(),e.preventDefault(),!1):void 0):void 0},on_model_change:function(e,t){var n,i,r,l=this,o=l.$model,a=l.$autobind,u=!!l.$livebind,s=Wt(l.$atbind,null,a?[o.id+yt(t.key)]:0),c="undefined"!=typeof document;c&&(n=l.get(s[0]),a&&(i=l.get(s[2])),t.$callData&&t.$callData.$trigger&&(r=function(e){return e!==t.$callData.$trigger},n=te(n,r),a&&(i=te(i,r)),t.$callData=null)),c&&n.length&&Jt(l,e,n,t),c&&a&&i.length&&en(l,e,i,t),u&&l.$tpl&&tn(l,e,t)},on_model_error:function(e,t){var n,i,r=this,l=r.$model,o=r.$autobind,a=!!r.$livebind,u=Wt(r.$atbind,null,o?[l.id+yt(t.key)]:0),s="undefined"!=typeof document;s&&(n=r.get(u[0])).length&&Jt(r,e,n,t),s&&o&&(i=r.get(u[2])).length&&en(r,e,i,t),a&&r.$tpl&&tn(r,e,t)},do_nop:null,do_each:function(e,t,n){},do_prop:function(e,t,n){if(Z(n.prop,z)){var i,r,l,o,a,u=this,s=u.$model,c=n.prop;t=(a=t[oe]("data-domref"))?on.getDomRef(t,a):[t],t&&t.length&&ne(t,function(e){if(e)for(i in c)if(c[le](i)){if(r=c[i],!s.has(r))continue;switch(l=s.get(r),o=Y(l),i){case"value":Fe(e,l);break;case"checked":case"disabled":e[i]=P===o?l:b(l)==e[ve];break;case"options":if("SELECT"===e[he]&&H===o){var t,n,a=l.length,u="",f=je("optgroup",e);for(t=Ie(e),f=f.length?f[0]:e,ne(je("option",f),function(e){f.removeChild(e)}),n=0;a>n;n++)u+=l[n]&&l[n].label?'<option value="'+l[n].value+'">'+l[n].label+"</option>":'<option value="'+l[n]+'">'+l[n]+"</option>";f[ye]=u,He(e,t)}break;default:e[ae](i,l)}}})}},do_html:function(e,t,n){if(n.key){var i,r=this,l=r.$model,o=n.key;t=(i=t[oe]("data-domref"))?on.getDomRef(t,i):[t],t&&t.length&&o&&l.has(o)&&ne(t,function(e){e&&(e[n.text?ke in e?ke:_e:ye]=l.get(o))})}},do_css:function(e,t,n){if(Z(n.css,z)){var i,r,l,o,a=this,u=a.$model,s=n.css;t=(o=t[oe]("data-domref"))?on.getDomRef(t,o):[t],t&&t.length&&ne(t,function(e){if(e)for(r in s)s[le](r)&&(i=s[r],l=u.get(i),l&&(e.style[r]=l))})}},do_set:function(e,t,n){var i,r,l=this,o=l.$model,a=null;n.key?a=n.key:t[de]&&(t[Ut]||(t[Ut]=o.key(t[de],1)),a=t[Ut]),a&&(n[le]("value")?i=n.value:((r=t[oe]("data-domref"))&&(t=on.getDomRef(t,r)[0]),i=ze(t)),o.set(a,i,1))},do_tpl:function(e,t,n){var i,r,l,o,a=this,u=n.key,s=n.tpl;a.$template&&u&&s&&(i=a.$model,u&&i.has(u)&&(t=(o=t[oe]("data-domref"))?on.getDomRef(t,o):[t],t&&t.length&&(r=n.mode||"replace",l=a.$template(s,i.get(u)),ne(t,function(e){e&&("replace"==r&&(e[ye]=""),l&&(e[ye]+=l))}))))},do_show:function(e,t,n){var i,r,l,o=this,a=o.$model,u=n.key;u&&(t=(r=t[oe]("data-domref"))?on.getDomRef(t,r):[t],t&&t.length&&(i=a.get(u),l=n[le]("value")?n.value===i:!!i,ne(t,function(e){e&&(l?Ve(e):Pe(e))})))},do_hide:function(e,t,n){var i,r,l,o=this,a=o.$model,u=n.key;u&&(t=(r=t[oe]("data-domref"))?on.getDomRef(t,r):[t],t&&t.length&&(i=a.get(u),l=n[le]("value")?n.value===i:!!i,ne(t,function(e){e&&(l?Pe(e):Ve(e))})))},do_bind:function(e,t,n){var i,r,l,o=this,a=(o.$model,n.name),u=n.key,s=t[pe].toLowerCase();u&&(i=n.value,r=Y(i),"radio"===s?b(i)==t[ve]&&(ne(o.get('input[name="'+a+'"]'),function(e){t!==e&&(e[se]=!1)}),t[se]=!0):"checkbox"===s?(l=Yt.test(a),l?(i=H===r?i:[i],t[se]=Xt(i,t[ve])):H===r?t[se]=Xt(i,t[ve]):t[se]=P===r?i:b(i)==t[ve]):Fe(t,i))},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.81.1",UUID:Ze,Extend:re,Event:a,Type:ut,Validation:st,PublishSubscribeInterface:nt,Cache:it,Model:Lt,Tpl:Bt,View:on},!function(e,t,n){e.jquery=function(t){if(!t.ModelView){t.ModelView=e;var n=(Function.prototype.call.bind(Array.prototype.slice),t.extend),i=e.View,r=e.Model;t.fn.modelview=function(e,l,o){var a=arguments.length,u=a?e:null,s=e,c=!0,f=!1,d=[];return this.each(function(){var e,o,h,p,v=t(this);if(v.data("modelview")){if(c=!1,o=v.data("modelview"),e=o.$model,"view"===u)d.push(o);else if("model"===u){if(a>1)return o.model(l),this;d.push(e)}else if("data"===u){if(a>1)return e.data(l),this;d.push(e.data())}else"sync"===u?o.sync(l):"reset"===u?o.reset():"dispose"===u&&(v.data("modelview",null),o.dispose());return this}return f||(h={id:"model",data:{},types:{},validators:{},getters:{},setters:{},dependencies:{}},p={viewClass:i,modelClass:r,id:"view",bindAttribute:"data-bind",livebind:null,autobind:!1,isomorphic:!1,bindbubble:!1,autovalidate:!0,events:null,autoSync:!0,cacheSize:i._CACHE_SIZE,refreshInterval:i._REFRESH_INTERVAL,model:null,template:null,actions:{},handlers:{},shortcuts:{}},s=n({},p,s),!s.model||s.model instanceof r||(s.model=n({},h,s.model)),f=!0),s.model?(e=s.model instanceof r?s.model:new s.modelClass(s.model.id,s.model.data,s.model.types,s.model.validators,s.model.getters,s.model.setters,s.model.dependencies),o=new s.viewClass(s.id,e,{bind:s.bindAttribute||"data-bind"},s.cacheSize,s.refreshInterval).template(s.template).events(s.handlers).shortcuts(s.shortcuts).actions(s.actions).livebind(s.livebind).autobind(s.autobind).isomorphic(s.isomorphic).bindbubble(s.bindbubble).autovalidate(s.autovalidate).bind(s.events,v[0]),v.data("modelview",o),void(s.autoSync&&o.sync())):this}),!c&&d.length?1==this.length?d[0]:d:this}}!t.widget||t.mvc&&t.mvc.ModelViewWidget||t.widget("mvc.ModelViewWidget",{options:{},$view:null,_create:function(){var e=this;e.$view=e.element.modelview(e.options).modelview("view")},value:function(e,t){var n=this;return 1<arguments.length?(n.$view.$model.set(e,t,1),n.element):n.$view.$model.get(e)},view:function(){return this.$view},model:function(){return this.$view.$model},_destroy:function(){var e=this.self.$view=null;e.element.modelview("dispose")}})},"undefined"!=typeof t.jQuery&&e.jquery(t.jQuery)}(e.ModelView,this),e.ModelView});